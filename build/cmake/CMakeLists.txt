##
# @file
#
# CMake configuration file.
#
#
# This file is part of the PolSar System.
#
# Copyright 2015 Etore Marcari Junior
#
# @author Etore Marcari Jr. <etore@dpi.inpe.br>
#

CMAKE_MINIMUM_REQUIRED( VERSION 3.2.0 )

PROJECT( PolSarSystem )

SET( PROJECT_VERSION "0.0.0" )

SET( PACKAGE ${CMAKE_PROJECT_NAME} )
SET( VERSION ${PROJECT_VERSION} )

SET( POLSARSYS_ROOT_DIR ${CMAKE_CURRENT_SOURCE_DIR}/../.. )

SET( BINARY_DIR ${POLSARSYS_ROOT_DIR}/bin )

SET( CMAKE_PREFIX_PATH "C:/Program Files (x86)/Microsoft SDKs/Windows/v7.0A;C:/terralib/3rdparty-win32-qt5;C:/Qt/Qt5.4.1/5.4/msvc2010_opengl/lib/cmake/Qt5" )

SET( CMAKE_MODULE_PATH ${CMAKE_CURRENT_SOURCE_DIR}/modules )

SET( INCLUDES )

LIST( APPEND INCLUDES ${CMAKE_SOURCE_DIR} ${CMAKE_BINARY_DIR} )

IF( NOT DEFINED TERRALIB_DIR )
    SET( TERRALIB_DIR C:/terralib/codebase )
    # SET( TERRALIB_DIR "C:/terralib/codebase" )
ENDIF()

FILE( GLOB POLSARSYS_HEADERS ${POLSARSYS_ROOT_DIR}/source/*.h )
FILE( GLOB POLSARSYS_SOURCES ${POLSARSYS_ROOT_DIR}/source/*.cpp )

FILE( GLOB POLSARSYS_TL_HEADERS ${POLSARSYS_ROOT_DIR}/source/terralib/*.h )
FILE( GLOB POLSARSYS_TL_SOURCES ${POLSARSYS_ROOT_DIR}/source/terralib/*.cpp )

# BOOST
FIND_PACKAGE( Boost 1.53.0 REQUIRED COMPONENTS unit_test_framework system date_time chrono timer filesystem thread )
INCLUDE_DIRECTORIES( ${Boost_INCLUDE_DIRS} )
LINK_LIBRARIES( ${Boost_LIBRARIES} )

IF( NOT Boost_FOUND )
    MESSAGE( FATAL_ERROR "  Could not find required Boost libraries" )
ELSE()
    MESSAGE( "  Found required Boost libraries" )
ENDIF()

# TERRALIB INCLUDE DIR
FIND_PATH( TERRALIB_INCLUDE_DIR common.h HINTS ${TERRALIB_DIR}/src/terralib )

# TERRALIB INCLUDE CONFIG DIR
FIND_PATH( TERRALIB_INCLUDE_CONFIG_DIR terralib_config.h HINTS ${TERRALIB_DIR}/../build-win32 )

# TERRALIB COMMON
FIND_LIBRARY( TERRALIB_COMMON_LIBRARY NAMES terralib_mod_common PATHS ${TERRALIB_DIR}/../build-win32/Debug )

# TERRALIB PLUGIN
FIND_LIBRARY( TERRALIB_PLUGIN_LIBRARY NAMES terralib_mod_plugin PATHS ${TERRALIB_DIR}/../build-win32/Debug )

# TERRALIB RASTER
FIND_LIBRARY( TERRALIB_RASTER_LIBRARY NAMES terralib_mod_raster PATHS ${TERRALIB_DIR}/../build-win32/Debug )

# TERRALIB RASTER PROCESSING
FIND_LIBRARY( TERRALIB_RP_LIBRARY NAMES terralib_mod_rp PATHS ${TERRALIB_DIR}/../build-win32/Debug )			 

# TERRALIB DATAACCESS
# FIND_LIBRARY( TERRALIB_DATAACCESS_LIBRARY NAMES terralib_mod_dataaccess PATHS ${TERRALIB_DIR}/../build-win32/Debug )

# GDAL
# FIND_LIBRARY( TERRALIB_GDAL_LIBRARY NAMES terralib_mod_gdal PATHS ${TERRALIB_DIR}/../build-win32/Debug )

IF( TERRALIB_INCLUDE_DIR AND TERRALIB_INCLUDE_CONFIG_DIR AND
    TERRALIB_COMMON_LIBRARY AND TERRALIB_PLUGIN_LIBRARY AND
    TERRALIB_RASTER_LIBRARY AND TERRALIB_RP_LIBRARY )
    # AND TERRALIB_DATAACCESS_LIBRARY AND TERRALIB_GDAL_LIBRARY )
    SET( TERRALIB_FOUND TRUE )
    MESSAGE( "  Found TERRALIB" )
ELSE()
    SET( TERRALIB_FOUND FALSE )
    MESSAGE( FATAL_ERROR "  Can't find TERRALIB" )
ENDIF()

MARK_AS_ADVANCED( TERRALIB_INCLUDE_DIR TERRALIB_INCLUDE_CONFIG_DIR TERRALIB_COMMON_LIBRARY TERRALIB_PLUGIN_LIBRARY TERRALIB_RASTER_LIBRARY TERRALIB_RP_LIBRARY )  #TERRALIB_DATAACCESS_LIBRARY TERRALIB_GDAL_LIBRARY)

SET( LIBS )

IF( TERRALIB_FOUND )
    INCLUDE_DIRECTORIES( ${TERRALIB_INCLUDE_DIR} )
    INCLUDE_DIRECTORIES( ${TERRALIB_INCLUDE_CONFIG_DIR} )

    LINK_DIRECTORIES( ${TERRALIB_INCLUDE_DIR} )
    LINK_DIRECTORIES( ${TERRALIB_INCLUDE_CONFIG_DIR} )
    LINK_DIRECTORIES( ${TERRALIB_COMMON_LIBRARY} )
    LINK_DIRECTORIES( ${TERRALIB_PLUGIN_LIBRARY} )
    LINK_DIRECTORIES( ${TERRALIB_RASTER_LIBRARY} )
    LINK_DIRECTORIES( ${TERRALIB_RP_LIBRARY} )

    SET( LIBS ${LIBS} ${TERRALIB_COMMON_LIBRARY} ${TERRALIB_PLUGIN_LIBRARY} ${TERRALIB_RASTER_LIBRARY} ${TERRALIB_RP_LIBRARY} )
ENDIF()

ADD_DEFINITIONS( -DBOOST_ALL_NO_LIB -DBOOST_FILESYSTEM_VERSION=3 -DBOOST_UBLAS_TYPE_CHECK=0 )

ADD_EXECUTABLE( polsar_system ${POLSARSYS_SOURCES} ${POLSARSYS_HEADERS} ${POLSARSYS_TL_SOURCES} ${POLSARSYS_TL_HEADERS} )
TARGET_LINK_LIBRARIES( polsar_system ${LIBS} )

FILE( GLOB POLSARSYS_TESTS_HEADERS ${POLSARSYS_ROOT_DIR}/tests/*.h )
FILE( GLOB POLSARSYS_TESTS_SOURCES ${POLSARSYS_ROOT_DIR}/tests/*.cpp )

# TERRALIB COMMON
FIND_LIBRARY( TERRALIB_COMMON_LIBRARY NAMES terralib_mod_common PATHS ${TERRALIB_DIR}/../build-win32/Debug )

ADD_EXECUTABLE( run_tests ${POLSARSYS_TESTS_SOURCES} ${POLSARSYS_TESTS_HEADERS} ${POLSARSYS_TL_SOURCES} ${POLSARSYS_TL_HEADERS} )
TARGET_LINK_LIBRARIES( run_tests ${LIBS} )

